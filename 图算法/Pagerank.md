#### Part1.0 假设

如果一个节点或者网页被其它重要的节点或者网页链接了，那么这个网页就是重要的,pagerank主要是根据节点之间的转移概率来衡量一个节点或者网页的重要性。



#### Part2.0 来由

早期的搜索引擎是根据关键字检索是是不考虑网页的质量的，如果一个网页中包含某个关键字越多的话，那么越容易被检索到，这样就会造成网页的作弊以及大量的为了提高被检索到但是内容却很low的低质量网站。总结一下

1. 返回结果质量不高：搜索结果不考虑网页的质量，而是通过时间顺序进行检索；
2. 容易被人钻空子：搜索引擎是基于检索词进行检索的，页面中检索词出现的频次越高，匹配度越高，这样就会出现网页作弊的情况。有些网页为了增加搜索引擎的排名，故意增加某个检索词的频率。

基于这些缺陷，当时 Google 的创始人拉里·佩奇提出了 PageRank 算法，目的就是要找到优质的网页，这样 Google 的排序结果不仅能找到用户想要的内容，而且还会从众多网页中筛选出权重高的呈现给用户。其灵感就是论文影响力因子的启发。

#### Part3.0 简化模型

![img](https://pic3.zhimg.com/v2-716e9607cdfaca7341c56d0b3e53345a_b.jpg)

前置知识

> 出度:一个节点的出度指由该节点出发指向其它节点的边的数量。
>
> 入度:一个节点的入读是指从其它节点出发指向该节点的边的数量

如何理解一个节点的重要度呢？或者说如何表示一个节点的重要度

> 1.如果一个商品被大量购买或者一家店被很多人关顾，我们就知道这个商品或者这家店就很多，从入度角度看，有很多条边指向该商品或者这家店。
>
> 2.从出度角度理解一个节点的重要性。比如说一个大牛，那么该大牛的朋友也会因为认识该大牛而被认为也是一个不错的人。这就是该节点对其它节点的影响力或者对其它节点影响力的贡献。

在pagerank中，一个节点的重要度通过pagerank值进行表示:
$$
PR(u) = \sum_{v \in out(v)}\frac{PR(v)}{L(v)}
$$
其中$out(v)$表示指向u的顶点集合，L(V)为顶点V的出度，PR(V)为顶点V的Pagerank值，从以上公式我们可以知道，一个顶点的pagerank值可以为所有指向该顶点的pr值的加权求和。所以你能看到，出链会给被链接的页面赋予影响力，当我们统计了一个网页链出去的数量，也就是统计了这个网页的跳转概率。

> ★  在这个例子中，你能看到 A 有三个出链分别链接到了 B、C、D 上。那么当用户访问 A 的时候，就有跳转到 B、C 或者 D 的可能性，跳转概率均为 1/3。
>
> B 有两个出链，链接到了 A 和 D 上，跳转概率为 1/2。
>
> 这样，我们可以得到 A、B、C、D 这四个网页的转移矩阵 M： 

![img](https://pic3.zhimg.com/v2-577a16d30f0b17fd4b487486bb6b3be2_b.jpg)

这个转移矩阵的每一列表示每一个顶点对其它页面的贡献度(也就是从该顶点跳转到其它顶点的概率)，矩阵的每一行表示其它顶点跳转到我这里的概率。

有了这个转移矩阵，我们就可以计算每个页面的影响力是多少了。

> ★  比如上图A页面的影响力怎么计算呢？ 其实我们是通过他的入链点B、C的影响力去计算的，也就是我们的那个公式。 开始我们假设四个页面的影响力相同，都是1/4。 则A第一次的影响力这么想，B有两条出链，那么会给我传过它影响力的1/2。 C有一条出链，那么会把它的影响力全传给A。
> 故： PR(A) = 1/4 * 1/2 + 1/4
> 这是一次迭代。你发现了吗？ 这其实就是转移矩阵M的第一行 * 一个全为1/4的列向量得到的（向量乘法）
>  ”

所以如果我们利用向量的乘法原理的话，只需要一个向量乘法就可以计算出每个页面的影响力了。

我们假设 A、B、C、D 四个页面的初始影响力都是相同的，即： 

![img](https://pic3.zhimg.com/v2-457d84df134ba11764af29eceb51404a_b.png)

 当进行第一次转移之后，各页面的影响力 w1 变为： 

![img](https://pic4.zhimg.com/v2-2207407d2f7afb47357d0dba59f00497_b.jpg)

 然后我们再用转移矩阵乘以 w1 得到 w2 结果，直到第 n 次迭代后 wn 影响力不再发生变化，可以收敛到 (0.3333，0.2222，0.2222，0.2222），也就是对应着 A、B、C、D 四个页面最终平衡状态下的影响力

上面对应的情况都是一个节点既有出链同时也有入链的时候，当一个节点只有入链没有出链或者一个节点只有出链没有入链的时候会发生什么呢？

##### 等级泄露（Rank Leak）：如果一个网页没有出链，就像是一个黑洞一样，吸收了其他网页的影响力而不释放，最终会导致其他网页的 PR 值为 0

![img](https://pic1.zhimg.com/v2-df17439fe18fd1eeedf9668a92ca8e70_b.jpg)

##### 等级沉没（Rank Sink）：如果一个网页只有出链，没有入链（如下图所示），计算的过程迭代下来，会导致这个网页的 PR 值为 0（也就是不存在公式中的 V）。

![img](https://pic2.zhimg.com/v2-56690a79a3a09729110b7d3bb52bc041_b.jpg)

两个列子来帮助理解

> 1.等级泄露(节点只有入链，但是没有出链)，比如练武，如果一个人在不停的接受别人传给他的功力，而不回传功力给其它人，那么这个人到最后肯定是一个武林高手，但是其它人可能因为一直在传功给他而导致武功慢慢衰退。
>
> 2.等级沉没(节点只有出链，但是没有入链)如果一个人只往外传功力，不接收外来人的功力，比如给人疗伤的时候，那么这个人很快也就会功力丧失了。（武侠小说中疗伤的时候，某个大侠给人疗着疗着自己就昏过去了）

## Part4.0 PageRank 的随机浏览模型

为了解决简化模型中存在的等级泄露和等级沉没的问题，拉里·佩奇提出了 PageRank 的随机浏览模型。他假设了这样一个场景：用户并不都是按照跳转链接的方式来上网，还有一种可能是不论当前处于哪个页面，都有概率访问到其他任意的页面，比如说用户就是要直接输入网址访问其他页面，虽然这个概率比较小。

所以他定义了阻尼因子 d，这个因子代表了用户按照跳转链接来上网的概率，通常可以取一个固定值 0.85，而 1-d=0.15 则代表了用户不是通过跳转链接的方式来访问网页的(随机重启的概率)，比如直接输入网址。 
$$
PR(u) = \frac{1-d}{N}+d\sum_{v \in in(u)}\frac{PR(v)}{LV(v)}
$$
 其中 N 为网页总数，这样我们又可以重新迭代网页的权重计算了，因为加入了阻尼因子 d，一定程度上解决了等级泄露和等级沉没的问题。

通过数学定理（这里不进行讲解）也可以证明，最终 PageRank 随机浏览模型是可以收敛的，也就是可以得到一个稳定正常的 PR 值。

