## **Part 1. 直观理解区分度的概念**

在探索性数据分析（EDA）中，若想大致判断自变量x对于因变量y有没有区分度，我们常会分正负样本群体来观察该变量的分布差异，如图1所示。那么，如何判断自变量是有用的？直观理解，**如果这两个分布的重叠部分越小，代表正负样本的差异性越大，自变量就能把正负样本更好地区分开。**

打个比方，想象这个变量就是一双手，把这两个分布**往两边拉开**。这双手的力量越大，两个概率分布**间隔**就越远，说明变量区分性就越好。

![img](https://pic3.zhimg.com/80/v2-2f5516fd94c1f244f27f1cbf1995b7a2_1440w.jpg)图 1 - 正负样本变量分布差异对比

## **Part 2. KS统计量的定义**

KS（Kolmogorov-Smirnov）统计量由两位苏联数学家A.N. Kolmogorov和N.V. Smirnov提出。在风控中，KS常用于评估模型区分度。区分度越大，说明模型的风险排序能力（ranking ability）越强。

KS统计量是基于经验累积分布函数（Empirical Cumulative Distribution Function，ECDF)
建立的，一般定义为：

![[公式]](https://www.zhihu.com/equation?tex=+ks+%3D+%5Cmax%5C%7B%7Ccum%28bad%5C_rate%29+-+cum%28good%5C_rate%29%7C%5C%7D+%5Ctag%7B1%7D)

## **Part 3. KS的计算过程及业务分析**

很多博客文章告诉我们，计算KS的常见方法是这样的：

- **step 1**. 对变量进行分箱（binning），可以选择等频、等距，或者自定义距离。
- **step 2**. 计算每个分箱区间的好账户数(goods)和坏账户数(bads)。
- **step 3**. 计算每个分箱区间的累计好账户数占总好账户数比率(cum_good_rate)和累计坏账户数占总坏账户数比率(cum_bad_rate)。
- **step 4**. 计算每个分箱区间累计坏账户占比与累计好账户占比差的**绝对值**，得到KS曲线。也就是： ![[公式]](https://www.zhihu.com/equation?tex=ks+%3D+%7Ccum%5C_goodrate+-+cum%5C_badrate%7C)
- **step 5.** 在这些绝对值中**取最大值**，得到此变量最终的KS值。

为帮助大家理解，现以具体数据（非业务数据）展示这一过程，如图2所示。其中，total是每个分数区间里的样本量，total_rate为样本量占比；bad代表逾期，bad_rate为每个分数区间里的坏样本占比。

![img](https://pic4.zhimg.com/80/v2-63fda3457b3e1f3b7a6f463896e5afcb_1440w.jpg)图 2 - KS计算过程表

那么，分析这张表我们可以得到哪些信息呢？

1. 模型分数越高，逾期率越低，代表是**信用评分**。因此，低分段bad rate相对于高分段更高， cum_bad_rate曲线增长速率会比cum_good_rate更快，**cum_bad_rate曲线在cum_good_rate上方。**
2. 每个分箱里的样本数基本相同，说明是**等频分箱**。分箱时需要考虑样本量是否满足统计意义。
3. 若我们设定策略cutoff为0.65（低于这个值的用户预测为bad，将会被拒绝），查表可知低于cutoff的cum_bad_rate为82.75%，那么将拒绝约82.75**%**的坏账户。
4. 根据bad_rate变化趋势，模型的**排序性很好**。如果是A卡（信用评分），那么对排序性要求就比较高，因为需要根据风险等级对用户**风险定价**。
5. 模型的KS达到53.1%，**区分度很强**。这是设定cutoff为0.65时达到的最理想状态。实际中由于需权衡通过率与坏账率之间的关系，一般不会设置在理想值。因此，**KS统计量是好坏距离或区分度的上限**。
6. 通常情况下，模型KS很少能达到52%，因此需要检验模型是否发生**过拟合，**或者**数据信息泄漏 。**



需要指出的是，KS是在放贷样本上进行评估的，相对于全量的申贷样本总是会有所偏差的，如果风控做的一般(申贷样本近似放贷样本，那么这样偏差就会小一点)，如果风控做的好，那么这个偏差就会大。

**当模型ks不佳时，可以优化的几个点**

1. 考虑入模变量是否已经在策略中使用
2. 考虑开发样本和验证样本之间的客群差异是否变化明显。
3. 开发对目标场景更具针对性的新特征。比如，识别长期信用风险，就使用一些强金融属性变量；识别欺诈风险，就使用一些短期负面变量。
4. 分群建模或分群测算。分群需要考虑稳定性和差异性
5. Bad case 分析 提取特征 ？

## **Part 4. 风控中选用KS指标的原因分析**

风控建模时，我们常把样本标签分为**GBIX**四类，其中：G = Good（好人，标记为0），B = Bad（坏人，标记为1），I = Indeterminate （不定，未进入表现期），X = Exclusion(排斥，异常样本)。

需要指出的是，**Good和Bad之间的定义往往是模糊、连续的，依赖于实际业务需求**。这里举两个例子或许能帮助大家理解：

**例1：模糊性**
对于12期信贷产品，如果设定表现期为前6期，S6D15（前6期中任意一期逾期超过15天）就是1，否则为0；但是后来如果把表现期调整为前3期，那么对于“**前3期都正常还款，但4～6期才发生逾期并超过15天**“的这部分样本而言，原本所定义的label就从1就变成0了。
因此，业务需求的不同，导致标签定义不是绝对的。

**例2：连续性**
定义首期逾期超过30天为1，否则为0。但是，逾期29天和逾期31天的用户之间其实并没有不可跨越的**硬间隔，**逾期29天的用户可能会进一步恶化为逾期31天。
由于逾期的严重程度定义本身就带有一定的主观性，我们很难说逾期天数差几天有多少本质的差异，所以哪怕我们为了转化为分类问题做了硬性的1和0的界限定义，但在业务上理解还是一个连续问题。

因此在风控中，**y的定义并不是非黑即白（离散型），而用概率分布（连续型）来衡量或许更合理**。

我们通常用**概率分布**来描述这种模糊的**软间隔**概念，也倾向于使用LR这种概率模型，而不是SVM这种以边界距离作为优化目标的模型。

那为什么选择KS指标呢？——KS指标倾向于从概率角度衡量正负样本分布之间的差异。正是因为正负样本之间的模糊性和连续性，所以KS也是一条连续曲线。但最终为什么取一个最大值，主要原因是提取KS曲线中的一个显著特征，从而便于相互比较。

## **Part 5. ROC曲线的几何绘制及理解**

在风控场景中，**样本不均衡**问题非常普遍，一般正负样本比都能达到1：100甚至更低。此时，评估模型的准确率是不可靠的。因为只要全部预测为负样本，就能达到很高的准确率。例如，如果数据集中有95个猫和5个狗，分类器会简单的将其都分为猫，此时准确率是95%。

因此，我们更倾向于用混淆矩阵来评估模型分类效果。

![img](https://pic3.zhimg.com/80/v2-efc1f9ede7a8098e8af8405599dae8a6_1440w.png)图 5 - 混淆矩阵

> 真阳率：![[公式]](https://www.zhihu.com/equation?tex=TPR+%3D+%5Cfrac%7BTP%7D%7BPositive%7D+%3D+%5Cfrac%7BTP%7D%7BTP+%2B+FN%7D) ——抓对了
> 假阳率：![[公式]](https://www.zhihu.com/equation?tex=FPR+%3D+%5Cfrac%7BFP%7D%7BNegative%7D+%3D+%5Cfrac%7BFP%7D%7BFP+%2B+TN%7D)——抓错了

为简化考虑，我们的风控系统只有一个信用评分模型，那么**高于分数阈值就预测为good，反之为bad**，予以拒绝。我们一般追求更高的TPR，也就是"抓对了"；以及更低的FPR，也就是"抓错了"。抓对了和抓错了——是在模型决策的一念之间（不同的分数阈值），因此我们会设置不同的阈值来观察这种变化规律。

在建立混淆矩阵的概念后，接下来介绍ROC曲线的绘制方法（后面将会以ROC曲线来辅助我们理解KS曲线）。

- **step 1**. 先按分数**升序**排列，计算某个阈值T下分数区间[0，T]内的TPR和FPR。可以把TPR理解为累积正样本率(cum_bad_rate)，FPR理解为累积负样本率(cum_good_rate)。

![img](https://pic1.zhimg.com/80/v2-a5fb93d0124874af395ed403255465d4_1440w.jpg)图 6 - TPR曲线绘制过程

- **step 2.** 重复step1多次，在不同阈值T下计算得到多个TPR和FPR。
- **step 3**. 以FPR为横轴，TPR为纵轴，画出ROC曲线（如图7）。曲线下方的面积即为AUC值。

![img](https://pic4.zhimg.com/80/v2-326a8b70fec6d55bd098987a1ed0e49f_1440w.jpg)图 7 - ROC曲线

我们该如何理解ROC曲线？

1. 如果模型没有任何排序性，那么正样本在每个分数区间上均匀分布。此时，无论如何设置阈值，[0，阈值]这个分数区间内TPR将与区间长度成正比关系，所以就是对角线。
2. 如果希望TPR尽可能高，FPR尽可能低，我们可以设计一个目标函数，这与KS的定义完全相同。

![[公式]](https://www.zhihu.com/equation?tex=ks+%3D++%5Cmax++%28%7CTPR-FPR%7C%29+%5Ctag%7B2%7D)

