**Noise Contrastive Estimation**: 噪声对比估计，作用是使我们在没有办法完成配分函数的计算时，也就估算出概率分布的参数。

##### Noise Contrastive Estamation 提出的背景

在指数族分布中，对于某个随机变量$x$，其概率$p(x)$表示如下形式:
$$
P(x) = \frac{e^{G(x)}}{Z}
\\ Z = \sum{P(x)}
$$
其中G(x)表示x的一种函数，比如G(x) = 3x这种形式。Z的话就是所有x的概率分布的求和的归一化函数，也称为配分函数。

##### 配分函数难算的原因

具体来说，不好算的原因可能有两个。一个是**计算量太大**，比如语言模型（包括 Word2Vec）的场景，因为要通过上下文来预测当前词的分布情况，这就需要对几十万甚至几百万项（取决于词表大小）进行求和来算归一化因子，这种情况下不是不能算，而是计算量大到难以承受了。

另一种情况是**根本算不出来**，比如假设：
$$
P(x) = \frac{e^{-ax^2+bx^4}}{Z}
$$
那么对Z的累加值也就是对$e^{-ax^2+bx^4}$求积分是很难计算的。(高斯分布的任意概率密度求积分都为1)

##### NCE解决思路

针对配分函数难以计算的问题，NCE提出将softmax等需要求配分函数的问题变为一个二分类问题，NCE的思想就是希望我们将真实的样本和噪声样本进行对比，从中发现真实样本的规律。此时，我们不直接去算$p(x)$，而是去算

们去算：

![img](https://image.jiqizhixin.com/uploads/editor/82bf809e-afe7-4db1-8e33-379aa57a6358/1529470679806.png)

这里的 θ 还是原来的待优化参数，而 γ 则是新引入的要优化的参数。

然后，NCE 的损失函数变为：

![img](https://image.jiqizhixin.com/uploads/editor/4067a0e4-df6f-463e-94dc-264c57c34271/1529470680022.png)

其中 p̃(x) 是真实样本，U(x) 是某个“均匀”分布或者其他的、确定的、方便采样的分布。 

说白了，**NCE 的做法就是将它转化为二分类问题，将真实样本判为 1，从另一个分布采样的样本判为 0**。

**等价于原来分布** 

现在的问题是，从 (5) 式估算出来的 θ，跟直接从 (3) 式的最大似然估计（理论上是可行的）出来的结果是不是一样的。 

**答案是基本一样的**。我们将 (5) 式中的 loss 改写为：

![img](https://image.jiqizhixin.com/uploads/editor/d8615f67-ec72-4110-8456-0fba6e0390db/1529470680274.png)

因为 p̃(x) 和 U(x) 都跟参数 θ，γ 没关，因此将 loss 改为下面的形式，不会影响优化结果：

![img](https://image.jiqizhixin.com/uploads/editor/a9f89751-95a2-42c3-9e9e-b7c820d49895/1529470683923.png)

其中：

![img](https://image.jiqizhixin.com/uploads/editor/11e7557e-8a43-4e41-b862-000264e39f43/1529470680787.png)

(7) 式是 KL 散度的积分，而 KL 散度非负，那么当“假设的分布形式是满足的、并且充分优化”时，(7) 式应该为 0，从而我们有 p̃(y|x)=p(y|x)，也就是：

![img](https://image.jiqizhixin.com/uploads/editor/e04e0338-c73f-4d6f-880a-c443bd5a3acc/1529470681409.png)

从中可以解得：

![img](https://image.jiqizhixin.com/uploads/editor/9f0ed770-3f89-41d6-929a-71aadd9c300e/1529470682299.png)

如果 U(x) 取均匀分布，那么 U(x) 就只是一个常数，所以最终的效果表明 γ−logU(x) 起到了 logZ 的作用，而分布还是原来的分布 (3)，θ 还是原来的 θ。

这就表明了 NCE 就是一种间接优化 (3) 式的巧妙方案：看似迂回，实则结果等价，并且 (5) 式的计算量也大大减少，因为计算量就只取决于采样的数目了。









